# 2024年春季学期数据库设计课程实践项目

## 食堂点餐系统

### 系统工作流程（功能点）

1. ~~用户信息查询~~
    - ~~用户可以查看自己账户的相关信息。~~

2. 商户搜索与浏览：
    - ~~用户可以使用搜索功能查找感兴趣的商户；~~
    - ~~搜索结果将显示一系列商户的简略信息，包括商户名称、主打菜品等；~~
        ~~+ 将地址字段添加了食堂信息~~
    - ~~用户可以查看商户更多详细信息。~~

3. 商户详细信息查看：
    - ~~用户可以查询一个商户的所有信息，包括菜单、菜品概要等；~~
    - ~~用户可以查看商户的评价和评分。~~
        + 后续考虑能否将商户Id换一种方式展示，给用户看id感觉不太好

4. 菜品搜索与浏览：
    - ~~用户可以在指定商户内搜索感兴趣的菜品；~~
        + ~~用DTO重构是否为主打菜品将0/1映射为是否。~~
    - ~~搜索结果将显示一系列菜品的简略信息，包括菜品名称、价格、图片等；~~
        + ~~图片貌似没有显示~~
    - ~~用户可以查看菜品更多详细信息。~~

5. 菜品详细信息查看：
    - ~~用户可以查询一个菜品的所有信息，包括菜品描述、价格、图片、成分、营养信息、可能存在的过敏源、用户评分、评价等。~~

6. 点餐：
    - ~~用户可以排队点餐也可以在线点餐，选择自己喜欢的菜品；~~
        ~~+ 暂时看起来没有线下点餐的功能，但是我觉得也不需要明天问一下老师能不能都线上吧。~~
        ~~+ **ANS:需要有，假设有一个外部数据源可以把线下数据弄过来，提供一个sel选择线下和线上吧**~~
    - ~~用户可以查看自己的订单信息。~~
        + 考虑菜品Id能不能换成菜品名，感觉菜品Id怪怪的

7. 收藏商户和菜品：
    - ~~用户可以收藏商户；~~
    - ~~用户可以收藏菜品。~~  
        + ~~收藏完后跳出弹窗提醒用户收藏成功~~

8. 查看消息列表：
    - ~~用户可以查看系统发送的消息列表，包括预订确认、订单状态更新等。~~
        + ~~预定确认的逻辑暂时不确定，明天可以问一下。~~
        + ~~**预定的指的是下预定订单，比如用户可以为明天中午订菜。**~~
        + ~~**这样的话，表结构可能也要对应更新一下，order要给一个reservationTime，**~~
        + ~~**然后orderStatus应该有 已完成，已取消，已预定，准备中。下订单会变成已预订，可以取消。预定的时间前一段时间会让用户确定，用户可以取消，默认确定，用户确定会变成准备中，最后reservationTime后变成已完成。**~~

9. 评价商品：
    - ~~用户用餐结束后可以对商户进行评价；~~
        + ~~目前好像下单了就可以评价，而且取消了也可以评价，这里后面考虑改一下。~~
        + ~~评价完可以考虑弹个弹窗~~
    - ~~用户可以对各个菜品进行评分（可以选择不进行评价/评分）。~~
        + ~~目前是手输，如果有空的话想办法规定下上下限吧~~

10. 商户信息管理与查询：
    - ~~商户可以查看自己的商户信息；~~
        + 后续考虑微重构一下，商户感觉也不用看到餐厅id
    - 商户可以发布、管理自己商户的菜单和价格；
        + ~~商户也没有提供添加过敏原、营养等信息的接口，用户也查不到，这个感觉可以涉及一下事务。~~
        + 如果过敏原是无的话，添加过敏原后会变成：无、麦糖精
        + ~~商户创建菜品时候的第一个价格不会被计入价格历史。~~
        + ~~商户添加菜品的时候好像没法提供图片，这个有点麻烦，明天问一下老师吧，要不然就没有图片的就提示用户暂无图片~~
          + **ANS：假设商户上传了图片，把url插入数据库** 
    - ~~商品可以设置分类，例如菜品、主食、饮品等。~~
11. ~~管理员操作：~~
    - ~~管理员可以管理用户、商户的相关信息，如添加/删除/修改用户/商户。~~
        + ~~好像可以把自己的年龄维护成-1岁，不过这个不涉及数据库主线，有空弄弄吧。~~
        + 后续考虑把商户的新增和修改做的更易用一点

### 三、系统用户

1. 系统管理员
    - ~~可以管理平台、菜品、商家和用户的信息。~~
        + ~~上面有~~

2. 商家（食堂商户）
    - ~~商家可以查看自己的相关信息；~~
        + ~~上面有~~
    - ~~商家可以发布、管理自己菜品的信息和价格；~~
    - ~~注意，在进行上述操作时可以假设已经登录商家。因此，在进行演示时，需要进行用户切换的操作。例如通过前端交互/发送 postman 请求的方式展示时，可以通过用户登录界面来实现商家的切换；如果通过命令行来进行演示，需要设置切换商家的相关命令。~~
        + ~~考虑登录失败/成功的时候跳一个弹窗吧~~

3. 用户（学生和教职工）
    - ~~用户可以查看自己的相关信息；~~
        + ~~上面有~~
    - ~~用户可以查看感兴趣的菜品信息；~~
        + ~~上面有~~
    - ~~用户可以查看指定菜品的价格变化情况；~~
        + ~~上面有~~
    - ~~用户可以收藏自己喜欢的菜品；~~
        + ~~上面有~~
    - 用户可以预订餐厅和点餐；
    - ~~用户可以收到点餐状态变化信息；~~
    - ~~注意，在进行上述操作时可以假设已经登录用户。因此，在进行演示时，需要进行用户切换的操作。例如通过前端交互/发送 postman 请求的方式展示时，可以通过用户登录界面来实现用户的切换；如果通过命令行来进行演示，需要设置切换用户的相关命令。~~

### 四、查询需求

系统需要为用户设计一套实用的数据查询功能，具体如下:

1. 基本查询需求
    - ~~查询某家商户的菜品简略信息列表；~~
    - ~~查询某菜品的详细信息；~~
    - ~~查询消息列表；~~
    - ~~查询某个用户的订单历史；~~
    - ~~查询所有商户的简略信息；~~
        + ~~明天问一下是不是要一个页面只显示简略信息吧，不然感觉我们的已经够了~~
        + **ANS：ok**
    - ~~查询某个商户所有菜品的收藏量；~~
    - ~~查询各个菜品通过排队点餐和在线点餐的销量；~~
        + ~~明天问问是不是这两个功能划给商户好一点~~
        + **ANS:ok**
    - PS: 数据量较大时，需要增加分页查询功能。

2. 进阶查询需求
    - 菜品数据分析：某个商户所有菜品的评分、销量以及购买该菜品次数最多的人；
        + 取消的订单好像也会计入导致最多的人好像也有一些问题
    - 某用户收藏的各个菜品在一段时间（近一周，近一月，近一年）内不同点餐方式的销量可进行筛选。界面上不要求用可视化图表来显示菜品销量对应关系。但需要强化相关查询能力，结果要能便于直接显示到界面（但不需要去实现这个界面；可自行规定数据格式，不需要针对特定的 UI 组件去实现数据格式）；
        + 好像菜品名的显示有问题，找个时间修一下，底层SQL可能也修一下不用太多个了。
    - 一段时间内某个商户的忠实粉丝在该商户的消费分布。（忠实粉丝：在该商户消费次数超过某个阈值的用户；消费分布：各个菜品购买次数）；
        + 取消的会计入
    - 用户活跃度分析：分析用户的活跃度模式，包括每周、每月点餐频率的变化趋势，以及用户在不同时间段的活跃程度；
        + 取消的会计入
    - 用户群体特征分析：根据用户的角色、年龄和性别等信息，对用户群体进行特征分析。比如根据年龄段/角色/性别对用户进行区分得出点餐习惯（在各个商户的用餐次数/某一菜品的购买数量/...）和评价习惯（评价的数量/评分给出的分数）；
        + 取消的会计入
    - ~~其他 1-2 种深度数据分析功能（自行挖掘有趣的需求）。~~
    + 实现了商户月度流水查询
    +  ~~明天问一下划分给用户和商户的合理不合理吧~~
    +  **ANS:ok**
### 五、补充说明

1. ~~基础数据~~
    - ~~用户至少需要包含:ID(唯一标识)，姓名，性别，学号/工号等信息；~~
    - ~~商家至少需要包含:ID(唯一标识)，名称，地址等信息；~~
    - ~~商品至少需要包含:ID(唯一标识)，名称，价格，分类，描述，图片等信息；~~
    - ~~上述要求并非完整要求，可根据常识和系统需求自行细化实体集的具体属性设计。~~

2. 数据联动的实现
    - 请合理使用触发器、存储过程等数据库提供的机制（并非必须使用，而是合理使用）。

3. 索引
    - 给数据表字段创建适当的索引，以支持大规模数据下的查询。

4. 事务
    - 对具有事务性质的操作，请务必使用事务进行实现；演示时可以通过相应的测试用例来演示在数据错误、功能异常时，如何保证数据库中的数据一致性。